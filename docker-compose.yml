services:
  osint-tool:
    build: .
    container_name: digital-footprint-investigator

    # Map Streamlit port
    ports:
      - "8501:8501"

    # Mount current directory for live code updates
    volumes:
      - .:/app
      - ./reports:/app/reports
      - ./logs:/app/logs
      # Anonymous volumes prevent Docker-generated dirs from leaking to host
      - /app/.venv
      - /app/venv
      - /app/__pycache__
      - /app/.pytest_cache

    # Load environment variables from .env file
    env_file:
      - .env

    # Restart policy
    restart: unless-stopped
    shm_size: 2gb

  tests:
    build: .
    container_name: osint-tests
    volumes:
      - .:/app
      - ./reports:/app/reports
      - ./logs:/app/logs
      # Anonymous volumes prevent Docker-generated dirs from leaking to host
      - /app/.venv
      - /app/venv
      - /app/__pycache__
      - /app/.pytest_cache
    env_file:
      - .env
    environment:
      - PYTHONPATH=.
      - PLAYWRIGHT_BROWSERS_PATH=/ms-playwright
    command: [ "pytest", "tests/ui" ]
    depends_on:
      - osint-tool
    shm_size: 2gb
